<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SEMPER-KI Backend</title>
    <style>
        /* Style for the result box */
        #resultBox {
            display: none; /* Initially hide the result box */
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Nothing to see here, go away!</h1>

    <p>Input fields for specifying the task parameters</p>
    <label for="x">Enter value for x:</label>
    <input type="number" id="x" placeholder="Enter value for x">

    <label for="y">Enter value for y:</label>
    <input type="number" id="y" placeholder="Enter value for y">

    <!-- Button to start a task -->
    <button onclick="startTask()">Start a Task</button>

    <!-- Button to trigger the check result -->
    <button onclick="checkResult()">Check Result</button>

    <!-- Result display box -->
    <div id="resultBox">
        <p id="resultText">No result available yet.</p>
    </div>

    <!-- JavaScript to handle the button clicks -->
    <script>
        var taskId; // Global variable to store the task ID
        
    
        function startTask() {
            // You can add JavaScript logic here to start a task
            var x = document.getElementById("x").value;
            var y = document.getElementById("y").value;
            // Constructing the payload in JSON format
            var payload = {
                args: [parseInt(x), parseInt(y)] // Assuming the arguments are integers
                // Add any other parameters or data needed for starting a task
            };
    
            // For simplicity, I'll use a placeholder URL
            // var startTaskUrl = 'http://localhost:8888/api/task/send-task/';
    
            // You can customize this based on your server API
            // For example, using fetch or XMLHttpRequest
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            var raw = JSON.stringify(payload);
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            fetch("http://localhost:8888/api/task/send-task/trialtask", requestOptions)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                taskId = data["task-id"];
                document.getElementById("resultText").innerText = `task started successfuly with ID. ${taskId}`;
                console.log(`task started successfuly with ID. ${taskId}`);

            })
            .catch(error => console.log('error', error));
        }
    
        function checkResult() {
            // Check if the task ID is available
            if (taskId) {
                // You can add JavaScript logic here if needed
                // For example, using fetch or XMLHttpRequest to get the result
                var resultUrl = `http://localhost:8888/api/task/info/${taskId}`;
    
                fetch(resultUrl)
                .then(response => response.json())
                .then(taskInfo => {
                    var state = taskInfo.state;
                    if (state === 'SUCCESS') {
                        var result = taskInfo.result;
                        console.log(`Task completed successfully. Result: ${result}`);
                        
                        // Show the result box and update the result text
                        document.getElementById("resultBox").style.display = "block";
                        document.getElementById("resultText").innerText = result;
                    } else if (state === 'PENDING') {
                        var eta = taskInfo.eta;
                        console.log(`Task is still pending. ETA: ${eta}`);
                    } else {
                        console.log(`Task is in state: ${state}`);
                    }
                })
                .catch(error => console.log('error', error));
            } else {
                console.log('Task ID is not available. Make sure the task is started.');
            }
        }
    </script>
    
</body>
</html>
